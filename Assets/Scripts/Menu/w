using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Adventure;


public class CustomizeAttack : MonoBehaviour{

    private List<GameObject> set_cards;
    private List<int> set_ids;
    private List<GameObject> get_cards;
    private List<int> get_ids;
    private int current;
    private APlayer aplayer;
    private int before;
    private int after;

    void Awake(){
        set_cards = new List<GameObject>();
        set_ids = new List<int>();
        get_cards = new List<GameObject>();
        get_ids = new List<int>();
        current = 65535;
        aplayer = GameObject.FindGameObjectWithTag("Player").GetComponent<APlayer>();
        before = after = -1;
    }

    private int IdToIndex(int i, bool isset){
        if(isset){
            return set_ids.IndexOf(i);
        }else{
            return get_ids.IndexOf(i);
        }
    }

    public void SubscribeCard(GameObject card, bool isset){
        if(isset){
            set_cards.Add(card);
            set_ids.Add(card.GetComponent<AttackCard>().GetId());
        }else{
            set_cards.Add(card);
            set_ids.Add(card.GetComponent<AttackCard>().GetId());
        }
    }

    public void SelectCard(int text_id, bool isset){
        AttackCard pre;
        AttackCard now;
        if(isset){
            if(current != 65535){ pre = set_cards[IdToIndex(current, true)].GetComponent<AttackCard>(); }
            now = set_cards[IdToIndex(text_id, true)].GetComponent<AttackCard>();
        }else{
            if(current != 65535){ pre = get_cards[IdToIndex(current, false)].GetComponent<AttackCard>(); }
            now = get_cards[IdToIndex(text_id, false)].GetComponent<AttackCard>();
        }


        if(current != 65535){ pre.OnDeselect(); }
        now.OnSelect();
        if(isset){
            before = text_id;
        }else{
            after = text_id;
        }
        current = text_id;

        if(before != -1 && after != -1){
            aplayer.ChangeAttacks(before, after);

            now.OnDeselect();
            current = 65535;
            before = after = -1;
        }
    }
}
